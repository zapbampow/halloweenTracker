<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸƒ Halloween Trick-or-Treater Counter</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
    <link rel="shortcut icon" href="/favicon.ico">
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <link rel="stylesheet" href="shared.css">
    <link rel="stylesheet" href="counter.css">
</head>

<body>
    <div class="floating-elements"></div>

    <a href="/stats" class="nav-link">ğŸ“Š View Stats</a>

    <div class="counter-container" id="counter-display">
        <div class="line1">You are the</div>
        <div class="line2">0th</div>
        <div class="line3">trick or treater tonight!</div>
    </div>

    <div class="instructions">
        Press ENTER to count a new trick-or-treater! ğŸƒ
    </div>

    <!-- Settings Button and Menu -->
    <!-- <div class="settings-container">
        <button class="settings-btn" onclick="toggleSettings()">âš™ï¸</button>
        <div class="settings-menu" id="settingsMenu">
            <div class="settings-header">ğŸƒ Settings</div>
            <button class="settings-option reset-btn" onclick="resetCount()">
                ğŸ”„ Reset Count for New Night
            </button>
            <div class="settings-warning">
                âš ï¸ This will delete all records!
            </div>
        </div>
    </div> -->

    <script>
        // Function to format the count with proper suffix
        function formatCount(count) {
            if (count === 0) return "0";

            const lastDigit = count % 10;
            const lastTwoDigits = count % 100;

            // Handle special cases (11th, 12th, 13th)
            if (lastTwoDigits >= 11 && lastTwoDigits <= 13) {
                return count + "th";
            }

            // Handle regular cases
            switch (lastDigit) {
                case 1: return count + "st";
                case 2: return count + "nd";
                case 3: return count + "rd";
                default: return count + "th";
            }
        }

        // Update counter display
        function updateCounter(count) {
            document.getElementById('counter-display').innerHTML = `
                <div class="line1">You are the</div>
                <div class="line2">${formatCount(count)}</div>
                <div class="line3">trick or treater tonight!</div>
            `;
        }

        // Handle Enter key press
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();

                // Send POST request to add record
                fetch('/api/record', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        updateCounter(data.count);

                        // Add a little celebration effect
                        document.body.style.animation = 'none';
                        document.body.offsetHeight; // Trigger reflow
                        document.body.style.animation = 'spookyGradient 0.5s ease-in-out';
                    })
                    .catch(error => {
                        console.error('Error adding record:', error);
                    });
            }
        });

        // Settings menu functionality
        function toggleSettings() {
            const menu = document.getElementById('settingsMenu');
            menu.classList.toggle('show');
        }

        // Reset count functionality
        function resetCount() {
            if (confirm('ğŸƒ Are you sure you want to reset the count?\n\nğŸ‘» This will delete ALL trick-or-treater records and start fresh for a new Halloween night!\n\nğŸ’€ This action cannot be undone!')) {
                fetch('/api/reset', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        updateCounter(0);

                        // Show success message
                        const menu = document.getElementById('settingsMenu');
                        menu.classList.remove('show');

                        // Temporary success indicator
                        const successMsg = document.createElement('div');
                        successMsg.className = 'reset-success';
                        successMsg.innerHTML = 'âœ… Count Reset! Ready for new trick-or-treaters! ğŸƒ';
                        document.body.appendChild(successMsg);

                        setTimeout(() => {
                            successMsg.remove();
                        }, 3000);
                    })
                    .catch(error => {
                        console.error('Error resetting count:', error);
                        alert('âŒ Failed to reset count. Please try again.');
                    });
            }
        }

        // Close settings menu when clicking outside
        document.addEventListener('click', function (event) {
            const settingsContainer = document.querySelector('.settings-container');
            if (!settingsContainer.contains(event.target)) {
                document.getElementById('settingsMenu').classList.remove('show');
            }
        });

        // Load initial count when page loads
        document.addEventListener('DOMContentLoaded', function () {
            fetch('/api/count')
                .then(response => response.json())
                .then(data => {
                    updateCounter(data.count);
                })
                .catch(error => {
                    console.error('Error loading count:', error);
                    updateCounter(0); // Fallback to 0 if error
                });
        });
    </script>
</body>

</html>